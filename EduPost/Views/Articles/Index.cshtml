@model EduPost.Models.ViewModels.SortedArticlesViewModel

@{
    ViewData["Title"] = "Your Articles";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="~/mundana/assets/img/favicon.ico">
    <link rel="icon" type="image/png" href="~/mundana/assets/img/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Edu Post - Your Articles</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700|Source+Sans+Pro:400,600,700" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <!-- Main CSS -->
    <link href="~/mundana/assets/css/main.css" rel="stylesheet" />
</head>
<body style="margin: 0; padding: 0; margin-top: 70px">
    <!--------------------------------------
    NAVBAR
    --------------------------------------->
    <!-- End Navbar -->
    <!--------------------------------------
    HEADER
    --------------------------------------->
    <div class="container-fluid" stye=margin-top:50px>
        <div class="jumbotron jumbotron-fluid mb-3 pt-0 pb-0 bg-lightblue position-relative">
            <div class="pl-4 pr-0 h-100 tofront">
                <div class="row justify-content-between">
                    <div class="col-md-6 pt-4 pb-4 align-self-center">
                        <h1 class="secondfont mb-3 font-weight-bold">Your Articles</h1>
                        <p class="mb-3">
                            You can watch your uploaded articles here
                        </p>
                        @* <a href="~/mundana/article.html" class="btn btn-dark">Read More</a> *@
                    </div>
                    <div class="col-md-6 d-none d-md-block pr-0" style="background-size:cover;background-image:url(~/mundana/assets/img/demo/home.jpg);">	</div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Header -->
    <!--------------------------------------
    MAIN
    --------------------------------------->

    <div class="sidebar">
        <a href="#" class="filter-button" data-status="all">All Articles</a>
        <a href="#" class="filter-button" data-status="pending">Pending Articles</a>
        <a href="#" class="filter-button" data-status="accepted">Accepted Articles</a>
        <a href="#" class="filter-button" data-status="declined">Declined Articles</a>
        <a href="#" class="filter-button" data-status="closed">Closed Articles</a>
        <a href="/Articles/Create" class="filter-button" style="color:black;Background:white">Submit Articles</a>
    </div>

    <div class="form-group">
        <div class="input-group" style="margin-bottom:10px;">
            <input type="text" id="search" placeholder="Search article" class="form-control" style="margin-bottom:10px" />
        </div>
    </div>

    <div class="content">
        <section class="status-group" data-status="pending">
            <h4>Pending Articles</h4>
            @foreach (var article in Model.PendingArticles)
            {
                <div class="result article-container">
                    <div class="article-header">
                        <span class="article-title text-truncate" style="max-width:775px">@article.ArticleTitle</span>
                        <div class="article-actions">
                            <a class="btn btn-warning" asp-action="Edit" asp-route-id="@article.ArticleId">Edit</a>
                            <a class="btn btn-primary" asp-action="Details" asp-route-id="@article.ArticleId">Details</a>
                            <a class="btn btn-danger" asp-action="Delete" asp-route-id="@article.ArticleId">Delete</a>
                        </div>
                    </div>
                    <p class="article-description">@article.Description</p>
                </div>
            }
        </section>
        <section class="status-group" data-status="accepted">
            <h4>Accepted Articles</h4>
            @foreach (var article in Model.AcceptedArticles)
            {
                <div class="result article-container">
                    <div class="article-header">
                        <span class="article-title text-truncate" style="max-width:775px">@article.ArticleTitle</span>
                        <div class="article-actions">
                            <a class="btn btn-primary" asp-action="Details" asp-route-id="@article.ArticleId">Details</a>
                            <a class="btn btn-danger" asp-action="Delete" asp-route-id="@article.ArticleId">Delete</a>
                            <a class="btn btn-primary" asp-action="Details" asp-controller="Home" asp-route-id="@article.ArticleId" class="btn btn-success" style="color:white">View On Page</a>
                        </div>
                    </div>
                    <p class="article-description">@article.Description</p>
                </div>
            }
        </section>
        <section class="status-group" data-status="declined">
            <h4>Declined Articles</h4>
            @foreach (var article in Model.DeclinedArticles)
            {
                <div class="result article-container">

                    <div class="article-header">
                        <span class="article-title text-truncate" style="max-width:775px">@article.ArticleTitle</span>
                        <div class="article-actions">
                            <a class="btn btn-warning" asp-action="Edit" asp-route-id="@article.ArticleId">Edit</a>
                            <a class="btn btn-primary" asp-action="Details" asp-route-id="@article.ArticleId">Details</a>
                            <a class="btn btn-danger" asp-action="Delete" asp-route-id="@article.ArticleId">Delete</a>
                        </div>
                    </div>

                    <p class="article-description">@article.Description</p>
                </div>
            }
        </section>
        <section class="status-group" data-status="closed">
            <h4>Closed Articles</h4>
            @foreach (var article in Model.ClosedArticles)
            {
                <div class="result article-container">
                    <div class="article-header">
                        <span class="article-title text-truncate" style="max-width:775px">@article.ArticleTitle</span>
                        <div class="article-actions">
                            <a class="btn btn-primary" asp-action="Details" asp-route-id="@article.ArticleId">Details</a>
                            <a class="btn btn-danger" asp-action="Delete" asp-route-id="@article.ArticleId">Delete</a>
                        </div>
                    </div>
                    <p class="article-description">@article.Description</p>
                </div>
            }
        </section>
    </div>

    <!--------------------------------------
    FOOTER
    --------------------------------------->
    <!-- End Footer -->
    <!--------------------------------------
    JAVASCRIPTS
    --------------------------------------->
    <script src="~/mundana/assets/js/vendor/jquery.min.js" type="text/javascript"></script>
    <script src="~/mundana/assets/js/vendor/popper.min.js" type="text/javascript"></script>
    <script src="~/mundana/assets/js/vendor/bootstrap.min.js" type="text/javascript"></script>
    <script src="~/mundana/assets/js/functions.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        //filter script
        document.addEventListener("DOMContentLoaded", function () {
            const buttons = document.querySelectorAll('.filter-button');
            const allGroups = document.querySelectorAll('.status-group');

            buttons.forEach(button => {
                button.addEventListener('click', function () {
                    const status = this.getAttribute('data-status');
                    allGroups.forEach(group => {
                        if (group.getAttribute('data-status') === status || status === 'all') {
                            group.style.display = '';
                        } else {
                            group.style.display = 'none';
                        }
                    });
                });
            });
        });

        //Search script
        $(document).ready(function () {
            const $search = $("#search");
            const $results = $(".result");

            function contains(textOne, textTwo) {
                return textOne.toLowerCase().includes(textTwo.toLowerCase());
            }

            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            const handleSearch = debounce(function () {
                const searchText = $search.val().toLowerCase();
                $results.each(function () {
                    const $result = $(this);
                    const headerText = $result.find(".article-title").text().toLowerCase();
                    const bodyText = $result.find(".article-description").text().toLowerCase(); // Corrected selector

                    $(this).toggle(contains(headerText, searchText) || contains(bodyText, searchText));
                });
            }, 250);

            $search.keyup(handleSearch);
        });
    </script>
</body>
</html>
